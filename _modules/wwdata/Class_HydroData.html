
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>wwdata.Class_HydroData &#8212; wwdata 0.1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">wwdata 0.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for wwdata.Class_HydroData</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Class_HydroData provides functionalities for handling data obtained in the context of (waste)water treatment.</span>

<span class="sd">Copyright (C) 2016 Chaim De Mulder</span>

<span class="sd">This program is free software: you can redistribute it and/or modify</span>
<span class="sd">it under the terms of the GNU General Public License as published by</span>
<span class="sd">the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd">(at your option) any later version.</span>

<span class="sd">This program is distributed in the hope that it will be useful,</span>
<span class="sd">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="sd">GNU General Public License for more details.</span>

<span class="sd">You should have received a copy of the GNU General Public License</span>
<span class="sd">along with this program.  If not, see http://www.gnu.org/licenses/.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">#import sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="c1">#from os import listdir</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>   <span class="c1">#plotten in python</span>
<span class="kn">import</span> <span class="nn">warnings</span> <span class="k">as</span> <span class="nn">wn</span>

<span class="kn">import</span> <span class="nn">wwdata.data_reading_functions</span> <span class="c1">#imports the functions in data_reading_functions.py: the ones without underscore are included, the ones with underscore need to be called by hp.data_reading_functions.function()</span>
<span class="c1">#import time_conversion_functions #import timedelta_to_abs, _get_datetime_info,\</span>
<span class="c1">#make_datetime,to_datetime_singlevalue</span>

<div class="viewcode-block" id="HydroData"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData">[docs]</a><span class="k">class</span> <span class="nc">HydroData</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    timedata_column : str</span>
<span class="sd">        name of the column containing the time data</span>
<span class="sd">    data_type : str</span>
<span class="sd">        type of data provided</span>
<span class="sd">    experiment_tag : str</span>
<span class="sd">        A tag identifying the experiment; can be a date or a code used by</span>
<span class="sd">        the producer/owner of the data.</span>
<span class="sd">    time_unit : str</span>
<span class="sd">        The time unit in which the time data is given</span>
<span class="sd">    units : array</span>
<span class="sd">        The units of the variables in the columns</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">timedata_column</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span><span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;WWTP&#39;</span><span class="p">,</span>
                 <span class="n">experiment_tag</span><span class="o">=</span><span class="s1">&#39;No tag given&#39;</span><span class="p">,</span><span class="n">time_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">units</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        initialisation of a HydroData object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Input data not convertable to DataFrame.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">timedata_column</span> <span class="o">==</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timename</span> <span class="o">=</span> <span class="s1">&#39;index&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timename</span> <span class="o">=</span> <span class="n">timedata_column</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">timedata_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">experiment_tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="n">time_unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">units</span>
        <span class="c1">#self.highs = pd.DataFrame(data=0,columns=[&#39;highs&#39;],index=self.data.index)</span>
        <span class="c1">#wn.warn(&#39;WARNING: Some functions in the OnlineSensorBased Class assume &#39; + \</span>
        <span class="c1">#&#39;equidistant data!!! This is primarily of importance when indexes are &#39; + \</span>
        <span class="c1">#&#39;missing!&#39;)</span>

<div class="viewcode-block" id="HydroData.set_tag"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.set_tag">[docs]</a>    <span class="k">def</span> <span class="nf">set_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the tag element of the HydroData object to the given tag</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span>
</div>
<div class="viewcode-block" id="HydroData.set_units"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.set_units">[docs]</a>    <span class="k">def</span> <span class="nf">set_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">units</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the units element of the HydroData object to a given dataframe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unit data not convertable to DataFrame type.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HydroData.set_time_unit"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.set_time_unit">[docs]</a>    <span class="k">def</span> <span class="nf">set_time_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">unit</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the time_unit element of the HydroData object to a given unit</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="n">unit</span>
</div>
<div class="viewcode-block" id="HydroData.head"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.head">[docs]</a>    <span class="k">def</span> <span class="nf">head</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;piping pandas head function, see https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.head.html for documentation&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HydroData.tail"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.tail">[docs]</a>    <span class="k">def</span> <span class="nf">tail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;piping pandas tail function, see https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.tail.html for documentation&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HydroData.index"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.index">[docs]</a>    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;piping pandas index function, see http://pandas.pydata.org/pandas-docs/version/0.22/generated/pandas.Index.html for documentation&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span>
</div>
    <span class="c1">#####################</span>
    <span class="c1">###   FORMATTING</span>
    <span class="c1">#####################</span>

<div class="viewcode-block" id="HydroData.fill_index"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.fill_index">[docs]</a>    <span class="k">def</span> <span class="nf">fill_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">arange</span><span class="p">,</span><span class="n">index_type</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        function to fill in missing index values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;This function assumes equidistant data and fills the indexes &#39;</span><span class="o">+</span>\
        <span class="s1">&#39;accordingly&#39;</span><span class="p">)</span>
        <span class="n">first_part</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="n">delta_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta_time</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">((</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">delta_time</span><span class="p">))]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">float</span><span class="p">):</span>
            <span class="n">day_length</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">],(</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">day_length</span><span class="p">)</span>

        <span class="n">fill_part</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

        <span class="n">last_part</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;</span> <span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">first_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fill_part</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_part</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_time</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">_reset_meta_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reset the meta dataframe, possibly for only a certain data series,</span>
<span class="sd">        should wrong labels have been assigned at some point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;original&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">),</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">())</span>
        <span class="c1">#self.meta_valid.drop(data_name,axis=1)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
                <span class="c1">#wn.warn(data_name + &#39; is not contained in self.meta_valid yet, so cannot\</span>
                <span class="c1">#be removed from it!&#39;)</span>

<div class="viewcode-block" id="HydroData.drop_index_duplicates"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.drop_index_duplicates">[docs]</a>    <span class="k">def</span> <span class="nf">drop_index_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        drop rows with a duplicate index. Also updates the meta_valid dataframe</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        It is assumed that the dropped rows containt the same data as their index-</span>
<span class="sd">        based duplicate, i.e. that no data is lost using the function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#len_orig = len(self.data)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">())</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_time</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">wn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Rows may change order using this function based on &#39;</span><span class="o">+</span> \
            <span class="s1">&#39;string values. Convert to datetime, int or float and use &#39;</span><span class="o">+</span> \
            <span class="s1">&#39;.sort_index() or .sort_value() to avoid. (see also hp.to_datetime())&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HydroData.replace"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.replace">[docs]</a>    <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">to_replace</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;piping pandas replace function, see http://pandas.pydata.org/pandas-docs/version/0.22/generated/pandas.DataFrame.replace.html for documentation&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inplace</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">timename</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">inplace</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="n">inplace</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HydroData.set_index"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.set_index">[docs]</a>    <span class="k">def</span> <span class="nf">set_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">keys</span><span class="p">,</span><span class="n">key_is_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">verify_integrity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">save_prev_index</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        piping and extending pandas set_index function, see https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.set_index.html for documentation</span>

<span class="sd">        Notes</span>
<span class="sd">        ----------</span>
<span class="sd">        key_is_time : bool</span>
<span class="sd">            when true, the new index will we known as the time data from here on</span>

<span class="sd">        (other arguments cfr pd.set_index)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        HydroData object (if inplace=False)</span>
<span class="sd">        None (if inplace=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">save_prev_index</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key_is_time</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Time values of type &quot;str&quot; can not be used as index&#39;</span><span class="p">)</span>
                <span class="n">timedata_column</span> <span class="o">=</span> <span class="s1">&#39;index&#39;</span>
            <span class="k">elif</span> <span class="n">key_is_time</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">timedata_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timename</span>

            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="n">drop</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                       <span class="n">verify_integrity</span><span class="o">=</span><span class="n">verify_integrity</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">timedata_column</span><span class="o">=</span><span class="n">timedata_column</span><span class="p">,</span>
                                  <span class="n">data_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="p">,</span><span class="n">experiment_tag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                  <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key_is_time</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timename</span> <span class="o">==</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;There already is a timeseries in the dataframe index!&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Time values of type &quot;str&quot; can not be used as index&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="n">drop</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">verify_integrity</span><span class="o">=</span><span class="n">verify_integrity</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_meta_valid_index</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">key_is_time</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timename</span> <span class="o">=</span> <span class="s1">&#39;index&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span>
</div>
    <span class="k">def</span> <span class="nf">_update_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        adjust the value of self.time, needed in some functions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timename</span> <span class="o">==</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">timename</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_update_meta_valid_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        update the index of the meta_valid dataframe to be the same as the one of the dataframe</span>
<span class="sd">        with the data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">()</span>

<div class="viewcode-block" id="HydroData.to_float"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.to_float">[docs]</a>    <span class="k">def</span> <span class="nf">to_float</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        convert values in given columns to float values</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        columns : array of strings</span>
<span class="sd">            column names of the columns where values need to be converted to floats</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">columns</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="c1">#.levels[0]</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Data type of column &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">column</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; not convertible to float&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_time</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="HydroData.to_datetime"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.to_datetime">[docs]</a>    <span class="k">def</span> <span class="nf">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">time_column</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span><span class="n">time_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">d-%mm-%yy&#39;</span><span class="p">,</span>
                    <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Piping and modifying pandas to_datetime function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        time_column : str</span>
<span class="sd">            column name of the column where values need to be converted to date-</span>
<span class="sd">            time values. Default &#39;index&#39; converts index values to datetime</span>
<span class="sd">        time_format : str</span>
<span class="sd">            the format to use by to_datetime function to convert strings to</span>
<span class="sd">            datetime format</span>
<span class="sd">        unit : str</span>
<span class="sd">            unit to use by to_datetime function to convert int or float values</span>
<span class="sd">            to datetime format</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">time_column</span> <span class="o">==</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">float</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="n">time_format</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">float</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_column</span><span class="p">],</span><span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
                                                        <span class="nb">format</span><span class="o">=</span><span class="n">time_format</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">time_column</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_time</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="HydroData.absolute_to_relative"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.absolute_to_relative">[docs]</a>    <span class="k">def</span> <span class="nf">absolute_to_relative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">time_data</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">save_abs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        converts a pandas series with datetime timevalues to relative timevalues</span>
<span class="sd">        in the given unit, starting from 0</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time_data : str</span>
<span class="sd">            name of the column containing the time data. If this is the index</span>
<span class="sd">            column, just give &#39;index&#39; (also default)</span>
<span class="sd">        unit : str</span>
<span class="sd">            unit to which to convert the time values (sec, min, hr or d)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None if inplace is True</span>
<span class="sd">        HydroData object if inplace it False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">time_data</span> <span class="o">==</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span>
            <span class="n">timedata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">timedata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_data</span><span class="p">]</span>
        <span class="n">time_delta</span> <span class="o">=</span> <span class="n">timedata</span> <span class="o">-</span> <span class="n">timedata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">relative</span> <span class="o">=</span> <span class="n">time_delta</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">total_seconds</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;sec&#39;</span><span class="p">:</span>
            <span class="n">relative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">relative</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
            <span class="n">relative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">relative</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;hr&#39;</span><span class="p">:</span>
            <span class="n">relative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">relative</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
            <span class="n">relative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">relative</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="n">unit</span>

        <span class="k">if</span> <span class="n">inplace</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;time_rel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relative</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">timename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">inplace</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">save_abs</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time_abs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timedata</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">time_data</span> <span class="o">==</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">relative</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_time</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_data</span><span class="p">]</span> <span class="o">=</span> <span class="n">relative</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
</div>
<div class="viewcode-block" id="HydroData.write"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="n">filepath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : str</span>
<span class="sd">            the path the output file should be saved to</span>
<span class="sd">        filename : str</span>
<span class="sd">            the name of the output file</span>
<span class="sd">        method : str (all,filtered,filled)</span>
<span class="sd">            depending on the method choice, different values will be written out:</span>
<span class="sd">            all values, only the filtered values or the filled values</span>
<span class="sd">        for_WEST : bool</span>
<span class="sd">        include_units : bool</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None; write an output file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span><span class="n">filename</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;filtered&#39;</span><span class="p">:</span>
            <span class="n">to_write</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">to_write</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;original&#39;</span><span class="p">]</span>
            <span class="n">to_write</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span><span class="n">filename</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;filled&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filled</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span><span class="n">filename</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
</div>
    <span class="c1">#######################</span>
    <span class="c1">### DATA EXPLORATION</span>
    <span class="c1">#######################</span>

<div class="viewcode-block" id="HydroData.get_avg"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.get_avg">[docs]</a>    <span class="k">def</span> <span class="nf">get_avg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">only_checked</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the averages of all or certain columns in a dataframe</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : arary of str</span>
<span class="sd">            name(s) of the column(s) containing the data to be averaged;</span>
<span class="sd">            defaults to [&#39;none&#39;] and will calculate average for every column</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame :</span>
<span class="sd">            pandas dataframe, containing the average slopes of all or certain</span>
<span class="sd">            columns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">only_checked</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span> <span class="o">==</span> <span class="s1">&#39;filtered&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>

            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">mean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">mean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">mean</span>
</div>
<div class="viewcode-block" id="HydroData.get_std"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.get_std">[docs]</a>    <span class="k">def</span> <span class="nf">get_std</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">only_checked</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the standard deviations of all or certain columns in a dataframe</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataframe : pd.DataFrame</span>
<span class="sd">            dataframe containing the columns to calculate the standard deviation for</span>
<span class="sd">        name : arary of str</span>
<span class="sd">            name(s) of the column(s) containing the data to calculate standard</span>
<span class="sd">            deviation for; defaults to [&#39;none&#39;] and will calculate standard</span>
<span class="sd">            deviation for every column</span>
<span class="sd">        plot : bool</span>
<span class="sd">            if True, plots the calculated standard deviations, defaults to False</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame :</span>
<span class="sd">            pandas dataframe, containing the average slopes of all or certain</span>
<span class="sd">            columns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">std</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="n">only_checked</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span> <span class="o">==</span> <span class="s1">&#39;filtered&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>

            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">std</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">std</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">std</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">std</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">std</span>
</div>
<div class="viewcode-block" id="HydroData.get_highs"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.get_highs">[docs]</a>    <span class="k">def</span> <span class="nf">get_highs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data_name</span><span class="p">,</span><span class="n">bound_value</span><span class="p">,</span><span class="n">arange</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;percentile&#39;</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        creates a dataframe with tags indicating what indices have data-values</span>
<span class="sd">        higher than a certain value; example: the definition/tagging of rain</span>
<span class="sd">        events.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_name : str</span>
<span class="sd">            name of the column to execute the function on</span>
<span class="sd">        bound_value : float</span>
<span class="sd">            the boundary value above which points will be tagged</span>
<span class="sd">        arange : array of two values</span>
<span class="sd">            the range within which high values need to be tagged</span>
<span class="sd">        method: str (value or percentile)</span>
<span class="sd">            when percentile, the bound value is a given percentile above which</span>
<span class="sd">            data points will be tagged, when value, bound_values is used directly</span>
<span class="sd">            to tag data points.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_highs</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data_to_use</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Slicing not possible for index type &quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot; and arange argument type &quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;. Try changing the type of the arange &quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;values to one compatible with &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> \
            <span class="s2">&quot; slicing.&quot;</span><span class="p">)</span>

        <span class="c1"># get indexes where flow is higher then bound_value</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span>
            <span class="n">bound_value</span> <span class="o">=</span> <span class="n">bound_value</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="ow">is</span> <span class="s1">&#39;percentile&#39;</span><span class="p">:</span>
            <span class="n">bound_value</span> <span class="o">=</span> <span class="n">data_to_use</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">bound_value</span><span class="p">)</span>

        <span class="n">indexes</span> <span class="o">=</span> <span class="n">data_to_use</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_to_use</span> <span class="o">&gt;</span> <span class="n">bound_value</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highs</span><span class="p">[</span><span class="s1">&#39;highs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_to_use</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">highs</span><span class="p">[</span><span class="s1">&#39;highs&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                    <span class="n">data_to_use</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">highs</span><span class="p">[</span><span class="s1">&#39;highs&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s1">&#39;-g&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_to_use</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">highs</span><span class="p">[</span><span class="s1">&#39;highs&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                    <span class="n">data_to_use</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">highs</span><span class="p">[</span><span class="s1">&#39;highs&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s1">&#39;.b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;high&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">data_name</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_reset_highs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;highs&#39;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">())</span>

    <span class="c1">##############</span>
    <span class="c1">### FILTERING</span>
    <span class="c1">##############</span>

<div class="viewcode-block" id="HydroData.add_to_meta_valid"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.add_to_meta_valid">[docs]</a>    <span class="k">def</span> <span class="nf">add_to_meta_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">column_names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds (a) column(s) with the given column_name(s) to the self.meta_filled</span>
<span class="sd">        DataFrame, where all tags are set to &#39;original&#39;. This makes sure that</span>
<span class="sd">        also data that already is very reliable can be used further down the</span>
<span class="sd">        process (e.g. filling etc.)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        column_names : array</span>
<span class="sd">            array containing the names of the columns to add to the meta_valied</span>
<span class="sd">            dataframe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span> <span class="o">=</span> <span class="s1">&#39;valid&#39;</span>
        <span class="c1"># Create/adjust self.filled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;original&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
                <span class="n">wn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;self.meta_valid already contains a column named &#39;</span> <span class="o">+</span>
                    <span class="n">column</span> <span class="o">+</span> <span class="s1">&#39;. The original column was kept.&#39;</span><span class="p">)</span>
</div>

<div class="viewcode-block" id="HydroData.tag_nan"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.tag_nan">[docs]</a>    <span class="k">def</span> <span class="nf">tag_nan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data_name</span><span class="p">,</span><span class="n">arange</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        adds a tag &#39;filtered&#39; in self.meta_valid for every NaN value in the given</span>
<span class="sd">        column</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_name : str</span>
<span class="sd">            column name of the column to apply the function to</span>
<span class="sd">        arange : array of two values</span>
<span class="sd">            the range within which nan values need to be tagged</span>
<span class="sd">        clear : bool</span>
<span class="sd">            when true, resets the tags in meta_valid for the data in column</span>
<span class="sd">            data_name</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span>

        <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reset_meta_valid</span><span class="p">(</span><span class="n">data_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(),</span><span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;!!&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">data_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="c1"># if the data_name column doesn&#39;t exist yet in the meta_valid dataset,</span>
            <span class="c1"># add it</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_to_meta_valid</span><span class="p">([</span><span class="n">data_name</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">arange</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">len_orig</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]),</span>
                                                  <span class="s1">&#39;filtered&#39;</span><span class="p">,</span><span class="s1">&#39;original&#39;</span><span class="p">)</span>
            <span class="n">len_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># check if arange has the right type</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">len_orig</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Slicing not possible for index type &quot;</span> <span class="o">+</span> \
                                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot; and arange &quot;</span><span class="o">+</span>\
                                <span class="s2">&quot;argument type &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot; or &quot;</span> <span class="o">+</span>\
                                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;. Try changing the type &quot;</span><span class="o">+</span>\
                                <span class="s2">&quot;of the arange values to one compatible with &quot;</span> <span class="o">+</span> \
                                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot; slicing.&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span>
                                                                       <span class="s1">&#39;filtered&#39;</span><span class="p">,</span><span class="s1">&#39;original&#39;</span><span class="p">)</span>
            <span class="n">len_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

        <span class="n">_print_removed_output</span><span class="p">(</span><span class="n">len_orig</span><span class="p">,</span><span class="n">len_new</span><span class="p">,</span><span class="s1">&#39;NaN tagging&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HydroData.tag_doubles"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.tag_doubles">[docs]</a>    <span class="k">def</span> <span class="nf">tag_doubles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data_name</span><span class="p">,</span><span class="n">bound</span><span class="p">,</span><span class="n">arange</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">log_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">final</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        tags double values that subsequently occur in a measurement series.</span>
<span class="sd">        This is relevant in case a sensor has failed and produces a constant</span>
<span class="sd">        signal. A band is provided within which the signal can vary and still</span>
<span class="sd">        be filtered out</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_name : str</span>
<span class="sd">            column name of the column from which double values will be sought</span>
<span class="sd">        bound : float</span>
<span class="sd">            boundary value of the band to use. When the difference between a</span>
<span class="sd">            point and the next one is smaller then the bound value, the latter</span>
<span class="sd">            datapoint is tagged as &#39;filtered&#39;.</span>
<span class="sd">        arange : array of two values</span>
<span class="sd">            the range within which double values need to be tagged</span>
<span class="sd">        clear : bool</span>
<span class="sd">            if True, the tags added to datapoints before will be removed and put</span>
<span class="sd">            back to &#39;original&#39;.</span>
<span class="sd">        inplace : bool</span>
<span class="sd">            indicates whether a new dataframe is created and returned or whether</span>
<span class="sd">            the operations are executed on the existing dataframe (nothing is</span>
<span class="sd">            returned). (This argument only comes into play when the &#39;final&#39;</span>
<span class="sd">            argument is True)</span>
<span class="sd">        log_file : str</span>
<span class="sd">            string containing the directory to a log file to be written out</span>
<span class="sd">            when using this function</span>
<span class="sd">        plot : bool</span>
<span class="sd">             whether or not to make a plot of the newly tagged data points</span>
<span class="sd">        final : bool</span>
<span class="sd">            if true, the values are actually replaced with nan values (either</span>
<span class="sd">            inplace or in a new hp object)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        HydroData object (if inplace=False)</span>
<span class="sd">            the dataframe from which the double values of &#39;data&#39; are removed or</span>
<span class="sd">            replaced</span>
<span class="sd">        None (if inplace=True)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span> <span class="o">=</span> <span class="s1">&#39;valid&#39;</span>
        <span class="n">len_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

        <span class="c1"># Make temporary object for operations</span>
        <span class="n">df_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">timedata_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timename</span><span class="p">,</span>
                                 <span class="n">data_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="p">,</span><span class="n">experiment_tag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                 <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)</span>
        <span class="c1"># Make a mask with False values for double values to be dropped</span>
        <span class="n">bound_mask</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">())</span> <span class="o">&gt;=</span> <span class="n">bound</span>
        <span class="c1"># Make sure the indexes are still the same in the mask and df_temp, so the</span>
        <span class="c1"># tagging can happen</span>
        <span class="n">bound_mask</span> <span class="o">=</span> <span class="n">bound_mask</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">df_temp</span><span class="o">.</span><span class="n">index</span><span class="p">())</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Make a mask with False values where data needs to be filtered</span>
        <span class="k">if</span> <span class="n">arange</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">bound_mask</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">range_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">())</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">bound_mask</span> <span class="o">+</span> <span class="n">range_mask</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Slicing not possible for index type &quot;</span> <span class="o">+</span> \
                                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot; and arange &quot;</span><span class="o">+</span>\
                                <span class="s2">&quot;argument type &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot; or &quot;</span> <span class="o">+</span>\
                                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;. Try changing the type &quot;</span><span class="o">+</span>\
                                <span class="s2">&quot;of the arange values to one compatible with &quot;</span> <span class="o">+</span> \
                                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot; slicing.&quot;</span><span class="p">)</span>

        <span class="c1"># Update the index of self.meta_valid</span>
        <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reset_meta_valid</span><span class="p">(</span><span class="n">data_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(),</span><span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;!!&#39;</span><span class="p">)</span>

        <span class="c1"># Do the actual filtering, based on the mask</span>
        <span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">len_new</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">log_file</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_print_removed_output</span><span class="p">(</span><span class="n">len_orig</span><span class="p">,</span><span class="n">len_new</span><span class="p">,</span><span class="s1">&#39;double value tagging&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">_log_removed_output</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span><span class="n">len_orig</span><span class="p">,</span><span class="n">len_new</span><span class="p">,</span><span class="s1">&#39;filtered&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Provide the location of the log file </span><span class="se">\</span>
<span class="s1">                            as a string type, or drop the argument if </span><span class="se">\</span>
<span class="s1">                            no log file is needed.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">mask</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;filtered&#39;</span>

        <span class="c1"># Create new temporary object, where the dropped datapoints are replaced</span>
        <span class="c1"># by nan values (by assigning a new column to the original dataframe)</span>
        <span class="c1">#df_temp_2 = self.__class__(self.data.copy(),timedata_column=self.timename,</span>
        <span class="c1">#                           experiment_tag=self.tag,time_unit=self.time_unit)</span>
        <span class="c1">#df_temp_2.data[data_name] = df_temp.data[data_name]</span>
        <span class="c1">#df_temp_2._update_time()</span>
        <span class="c1"># Update the self.meta_valid dataframe, to contain False values for dropped</span>
        <span class="c1"># datapoints. This is done by tracking the nan values in df_temp_2</span>
        <span class="c1">#if data_name in self.meta_valid.columns:</span>
        <span class="c1">#    temp_1 = self.meta_valid[data_name].isin([&#39;filtered&#39;])</span>
        <span class="c1">#    temp_2 = pd.DataFrame(np.where(np.isnan(df_temp_2.data[data_name]),True,False))</span>
        <span class="c1">#    temp_3 = temp_1 | temp_2</span>
        <span class="c1">#    self.meta_valid[data_name] = np.where(temp_3,&#39;filtered&#39;,&#39;original&#39;)</span>
        <span class="c1">#else:</span>
        <span class="c1">#    self.meta_valid[data_name] = np.isnan(df_temp_2.data[data_name])</span>
        <span class="c1">#    self.meta_valid[data_name] = np.where(self.meta_valid[data_name],&#39;filtered&#39;,&#39;original&#39;)</span>

        <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_analysed</span><span class="p">(</span><span class="n">data_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">final</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_time</span><span class="p">()</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">df_temp</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">final</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
</div>

<div class="viewcode-block" id="HydroData.tag_extremes"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.tag_extremes">[docs]</a>    <span class="k">def</span> <span class="nf">tag_extremes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data_name</span><span class="p">,</span><span class="n">arange</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;below&#39;</span><span class="p">,</span>
                     <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tags values above or below a given limit.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_name : str</span>
<span class="sd">            name of the column containing the data to be tagged</span>
<span class="sd">        arange : array of two values</span>
<span class="sd">            the range within which extreme values need to be tagged</span>
<span class="sd">        limit : int/float</span>
<span class="sd">            limit below or above which values need to be tagged</span>
<span class="sd">        method : &#39;below&#39; or &#39;above&#39;</span>
<span class="sd">            below tags all the values below the given limit, above tags</span>
<span class="sd">            the values above the limit</span>
<span class="sd">        clear : bool</span>
<span class="sd">            if True, the tags added before will be removed and put</span>
<span class="sd">            back to &#39;original&#39;.</span>
<span class="sd">        plot : bool</span>
<span class="sd">             whether or not to make a plot of the newly tagged data points</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reset_meta_valid</span><span class="p">(</span><span class="n">data_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(),</span><span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;!!&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">data_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="c1"># if the data_name column doesn&#39;t exist yet in the meta_valid dataset,</span>
            <span class="c1"># add it</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_to_meta_valid</span><span class="p">([</span><span class="n">data_name</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">arange</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">len_orig</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">])</span>
            <span class="n">mask_valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;filtered&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;below&#39;</span><span class="p">:</span>
                <span class="n">mask_tagging</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">&lt;</span><span class="n">limit</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">mask_tagging</span><span class="p">,</span><span class="n">mask_valid</span><span class="p">]))</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="s1">&#39;filtered&#39;</span><span class="p">,</span><span class="s1">&#39;original&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;above&#39;</span><span class="p">:</span>
                <span class="n">mask_tagging</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">&gt;</span><span class="n">limit</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">mask_tagging</span><span class="p">,</span><span class="n">mask_valid</span><span class="p">]))</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="s1">&#39;filtered&#39;</span><span class="p">,</span><span class="s1">&#39;original&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># check if arange has the right type</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">len_orig</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">mask_valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="s1">&#39;filtered&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Slicing not possible for index type &quot;</span> <span class="o">+</span> \
                                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot; and arange &quot;</span><span class="o">+</span>\
                                <span class="s2">&quot;argument type &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot; or &quot;</span> <span class="o">+</span>\
                                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;. Try changing the type &quot;</span><span class="o">+</span>\
                                <span class="s2">&quot;of the arange values to one compatible with &quot;</span> <span class="o">+</span> \
                                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot; slicing.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;below&#39;</span><span class="p">:</span>
                <span class="n">mask_tagging</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">&lt;</span><span class="n">limit</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">mask_tagging</span><span class="p">,</span><span class="n">mask_valid</span><span class="p">]))</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="s1">&#39;filtered&#39;</span><span class="p">,</span><span class="s1">&#39;original&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;above&#39;</span><span class="p">:</span>
                <span class="n">mask_tagging</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">&gt;</span><span class="n">limit</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">mask_tagging</span><span class="p">,</span><span class="n">mask_valid</span><span class="p">]))</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="s1">&#39;filtered&#39;</span><span class="p">,</span><span class="s1">&#39;original&#39;</span><span class="p">)</span>

        <span class="n">len_new</span> <span class="o">=</span> <span class="n">mask_tagging</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="n">_print_removed_output</span><span class="p">(</span><span class="n">len_orig</span><span class="p">,</span><span class="n">len_new</span><span class="p">,</span><span class="s1">&#39;tagging of extremes (&#39;</span><span class="o">+</span><span class="n">method</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_analysed</span><span class="p">(</span><span class="n">data_name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HydroData.calc_slopes"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.calc_slopes">[docs]</a>    <span class="k">def</span> <span class="nf">calc_slopes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span><span class="p">,</span><span class="n">time_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">slope_range</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates slopes for given xdata and data_name; if a time unit is given as</span>
<span class="sd">        an argument, the time values (xdata) will first be converted to this</span>
<span class="sd">        unit, which will then be used to calculate the slopes with.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xdata : str</span>
<span class="sd">            name of the column containing the xdata for slope calculation</span>
<span class="sd">            (e.g. time). If &#39;index&#39;, the index is used as xdata. If datetime</span>
<span class="sd">            objects, a time_unit is expected to calculate the slopes.</span>
<span class="sd">        data_name : str</span>
<span class="sd">            name of the column containing the data_name for slope calculation</span>
<span class="sd">        time_unit : str</span>
<span class="sd">            time unit to be used for the slope calculation (in case this is</span>
<span class="sd">            based on time); if None, slopes are simply calculated based on the</span>
<span class="sd">            values given</span>
<span class="sd">            !! This value has no impact if the xdata column is the index and is</span>
<span class="sd">            not a datetime type. If that is the case, it is assumed that the</span>
<span class="sd">            user knows the unit of the xdata !!</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.Series</span>
<span class="sd">            pandas Series object containing the slopes calculated for the</span>
<span class="sd">            chosen variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">slopes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">xdata</span> <span class="o">==</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">xdata</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span>

        <span class="n">date_time</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">xdata</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">)</span> <span class="ow">or</span> \
                    <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">xdata</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="ow">or</span> \
                    <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">xdata</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">pd</span><span class="o">.</span><span class="n">tslib</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">time_unit</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">date_time</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">slopes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ydata</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">xdata</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="n">time_unit</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Slope calculation cannot be executed, probably due to a </span><span class="se">\</span>
<span class="s1">                non-handlable datatype. Either use the time_unit argument or </span><span class="se">\</span>
<span class="s1">                use timedata of type np.datetime64, dt.datetime or pd.tslib.Timestamp.&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">time_unit</span> <span class="o">==</span> <span class="s1">&#39;sec&#39;</span><span class="p">:</span>
            <span class="n">slopes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ydata</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">/</span> \
                     <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">xdata</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">time_unit</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
            <span class="n">slopes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ydata</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">/</span> \
                     <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">xdata</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">seconds</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">time_unit</span> <span class="o">==</span> <span class="s1">&#39;hr&#39;</span><span class="p">:</span>
            <span class="n">slopes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ydata</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">/</span> \
                     <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">xdata</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">seconds</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">time_unit</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
            <span class="n">slopes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ydata</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">/</span> \
                     <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">xdata</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> \
                     <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">xdata</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">seconds</span> <span class="o">/</span> <span class="mi">3600</span> <span class="o">/</span> <span class="mi">24</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Could not calculate slopes. If you are using </span><span class="se">\</span>
<span class="s1">            time-units to calculate slopes, please make sure you entered a </span><span class="se">\</span>
<span class="s1">            valid time unit for slope calculation (sec, min, hr or d)&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xdata</span> <span class="o">==</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">slopes</span>
</div>
<div class="viewcode-block" id="HydroData.moving_slope_filter"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.moving_slope_filter">[docs]</a>    <span class="k">def</span> <span class="nf">moving_slope_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">xdata</span><span class="p">,</span><span class="n">data_name</span><span class="p">,</span><span class="n">cutoff</span><span class="p">,</span><span class="n">arange</span><span class="p">,</span><span class="n">time_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">log_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">final</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filters out datapoints based on the difference between the slope in one</span>
<span class="sd">        point and the next (sudden changes like noise get filtered out), based</span>
<span class="sd">        on a given cut off value. Replaces the dropped values with NaN values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xdata : str</span>
<span class="sd">            name of the column containing the xdata for slope calculation</span>
<span class="sd">            (e.g. time). If &#39;index&#39;, the index is used as xdata. If datetime</span>
<span class="sd">            objects, a time_unit is expected to calculate the slopes.</span>
<span class="sd">        data_name : str</span>
<span class="sd">            name of the column containing the data that needs to be filtered</span>
<span class="sd">        cutoff: int</span>
<span class="sd">            the cutoff value to compare the slopes with to apply the filtering.</span>
<span class="sd">        arange : array of two values</span>
<span class="sd">            the range within which the moving slope filter needs to be applied</span>
<span class="sd">        time_unit : str</span>
<span class="sd">            time unit to be used for the slope calculation (in case this is</span>
<span class="sd">            based on time); if None, slopes are calculated based on the values</span>
<span class="sd">            given</span>
<span class="sd">        clear : bool</span>
<span class="sd">            if True, the tags added to datapoints before will be removed and put</span>
<span class="sd">            back to &#39;original&#39;.</span>
<span class="sd">        inplace : bool</span>
<span class="sd">            indicates whether a new dataframe is created and returned or whether</span>
<span class="sd">            the operations are executed on the existing dataframe (nothing is</span>
<span class="sd">            returned)</span>
<span class="sd">        log_file : str</span>
<span class="sd">            string containing the directory to a log file to be written out</span>
<span class="sd">            when using this function</span>
<span class="sd">        plot : bool</span>
<span class="sd">            if true, a plot is made, comparing the original dataset with the</span>
<span class="sd">            new, filtered dataset</span>
<span class="sd">        final : bool</span>
<span class="sd">            if true, the values are actually replaced with nan values (either</span>
<span class="sd">            inplace or in a new hp object)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        HydroData object (if inplace=False)</span>
<span class="sd">            the dataframe from which the double values of &#39;data&#39; are removed</span>
<span class="sd">        None (if inplace=True)</span>

<span class="sd">        Creates</span>
<span class="sd">        -------</span>
<span class="sd">        A new column in the self.meta_valid dataframe, containing a mask indicating</span>
<span class="sd">        what values are filtered</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span> <span class="o">=</span> <span class="s1">&#39;valid&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">len_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Slicing not possible for index type &quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot; and arange argument type &quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;. Try changing the type of the arange &quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;values to one compatible with &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> \
            <span class="s2">&quot; slicing.&quot;</span><span class="p">)</span>

        <span class="c1">#if plot == True:</span>
        <span class="c1">#    original = self.__class__(self.data.copy(),timedata_column=self.timename,</span>
        <span class="c1">#                              experiment_tag=self.tag,time_unit=self.time_unit)</span>
        <span class="c1"># Make temporary object for operations</span>
        <span class="n">df_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                                 <span class="n">timedata_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timename</span><span class="p">,</span><span class="n">experiment_tag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                 <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)</span>
        <span class="c1"># Update the index of self.meta_valid</span>
        <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reset_meta_valid</span><span class="p">(</span><span class="n">data_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(),</span><span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;!!&#39;</span><span class="p">)</span>

        <span class="c1"># Calculate slopes and drop values in temporary object</span>
        <span class="n">slopes</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">calc_slopes</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="n">data_name</span><span class="p">,</span><span class="n">time_unit</span><span class="o">=</span><span class="n">time_unit</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">slopes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">slopes</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">cutoff</span><span class="p">:</span>
            <span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">slopes</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">slopes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">cutoff</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">slopes</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">calc_slopes</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="n">data_name</span><span class="p">,</span><span class="n">time_unit</span><span class="o">=</span><span class="n">time_unit</span><span class="p">)</span>
        <span class="n">len_new</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">log_file</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_print_removed_output</span><span class="p">(</span><span class="n">len_orig</span><span class="p">,</span><span class="n">len_new</span><span class="p">,</span><span class="s1">&#39;moving slope filter&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">_log_removed_output</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span><span class="n">len_orig</span><span class="p">,</span><span class="n">len_new</span><span class="p">,</span><span class="s1">&#39;filtered&#39;</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Please provide the location of the log file as &#39;</span><span class="o">+</span> \
                            <span class="s1">&#39;a string type, or leave the argument if no log &#39;</span><span class="o">+</span> \
                            <span class="s1">&#39;file is needed.&#39;</span><span class="p">)</span>
        <span class="c1"># Create new temporary object, where the dropped datapoints are replaced</span>
        <span class="c1"># by nan values</span>
        <span class="n">df_temp_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                                   <span class="n">timedata_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timename</span><span class="p">,</span><span class="n">experiment_tag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                   <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)</span>
        <span class="n">df_temp_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span>
        <span class="n">df_temp_2</span><span class="o">.</span><span class="n">_update_time</span><span class="p">()</span>
        <span class="c1"># Update the self.meta_valid dataframe, to contain False values for dropped</span>
        <span class="c1"># datapoints and for datapoints already filtered. This is done by</span>
        <span class="c1"># tracking the nan values in df_temp_2</span>
        <span class="k">if</span> <span class="n">data_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">temp_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;filtered&#39;</span><span class="p">])</span>
            <span class="n">temp_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">df_temp_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]),</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">temp_3</span> <span class="o">=</span> <span class="n">temp_1</span> <span class="o">|</span> <span class="n">temp_2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">temp_3</span><span class="p">,</span><span class="s1">&#39;filtered&#39;</span><span class="p">,</span><span class="s1">&#39;original&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">df_temp_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">],</span><span class="s1">&#39;filtered&#39;</span><span class="p">,</span><span class="s1">&#39;original&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_analysed</span><span class="p">(</span><span class="n">data_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">final</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_temp_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_time</span><span class="p">()</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">df_temp_2</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">final</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
</div>
<div class="viewcode-block" id="HydroData.simple_moving_average"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.simple_moving_average">[docs]</a>    <span class="k">def</span> <span class="nf">simple_moving_average</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">arange</span><span class="p">,</span><span class="n">window</span><span class="p">,</span><span class="n">data_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the Simple Moving Average of a dataseries from a dataframe,</span>
<span class="sd">        using a window within which the datavalues are averaged.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        arange : array of two values</span>
<span class="sd">            the range within which the moving average needs to be calculated</span>
<span class="sd">        window : int</span>
<span class="sd">            the number of values from the dataset that are used to take the</span>
<span class="sd">            average at the current point. Defaults to 10</span>
<span class="sd">        data_name : str or array of str</span>
<span class="sd">            name of the column(s) containing the data that needs to be</span>
<span class="sd">            smoothened. If None, smoothened data is computed for the whole</span>
<span class="sd">            dataframe. Defaults to None</span>
<span class="sd">        inplace : bool</span>
<span class="sd">            indicates whether a new dataframe is created and returned or whether</span>
<span class="sd">            the operations are executed on the existing dataframe (nothing is</span>
<span class="sd">            returned)</span>
<span class="sd">        plot : bool</span>
<span class="sd">            if True, a plot is given for comparison between original and smooth</span>
<span class="sd">            data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        HydroData (or subclass) object</span>
<span class="sd">            either a new object (inplace=False) or an adjusted object, con-</span>
<span class="sd">            taining the smoothened data values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">original</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Slicing not possible for index type &quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot; and arange argument type &quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;. Try changing the type of the arange &quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;values to one compatible with &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> \
            <span class="s2">&quot; slicing.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">original</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">window</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Window width exceeds number of datapoints!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">original</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                                      <span class="n">timedata_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timename</span><span class="p">,</span><span class="n">experiment_tag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                      <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">inplace</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">df_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                                     <span class="n">timedata_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timename</span><span class="p">,</span> <span class="n">experiment_tag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                     <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data_name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">df_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_name</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">()</span><span class="o">.</span>\
                                        <span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_name</span><span class="p">:</span>
                    <span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">()</span><span class="o">.</span>\
                                        <span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">inplace</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data_name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_name</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">()</span><span class="o">.</span>\
                                        <span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_name</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">()</span><span class="o">.</span>\
                                        <span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">original</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="n">original</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">],</span><span class="s1">&#39;r--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;original data&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">inplace</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_temp</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">],</span><span class="s1">&#39;b-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;averaged data&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">inplace</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">],</span><span class="s1">&#39;b-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;averaged data&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timename</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">data_name</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">inplace</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df_temp</span>
</div>
<div class="viewcode-block" id="HydroData.moving_average_filter"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.moving_average_filter">[docs]</a>    <span class="k">def</span> <span class="nf">moving_average_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data_name</span><span class="p">,</span><span class="n">window</span><span class="p">,</span><span class="n">cutoff_frac</span><span class="p">,</span><span class="n">arange</span><span class="p">,</span><span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">log_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">final</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filters out the peaks/outliers in a dataset by comparing its values to a</span>
<span class="sd">        smoothened representation of the dataset (Moving Average Filtering). The</span>
<span class="sd">        filtered values are replaced by NaN values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_name : str</span>
<span class="sd">            name of the column containing the data that needs to be filtered</span>
<span class="sd">        window : int</span>
<span class="sd">            the number of values from the dataset that are used to take the</span>
<span class="sd">            average at the current point.</span>
<span class="sd">        cutoff_frac: float</span>
<span class="sd">            the cutoff value (in fraction 0-1) to compare the data and smoothened</span>
<span class="sd">            data: a deviation higher than a certain percentage drops the data-</span>
<span class="sd">            point.</span>
<span class="sd">        arange : array of two values</span>
<span class="sd">            the range within which the moving average filter needs to be applied</span>
<span class="sd">        clear : bool</span>
<span class="sd">            if True, the tags added to datapoints before will be removed and put</span>
<span class="sd">            back to &#39;original&#39;.</span>
<span class="sd">        inplace : bool</span>
<span class="sd">            indicates whether a new dataframe is created and returned or whether</span>
<span class="sd">            the operations are executed on the existing dataframe (nothing is</span>
<span class="sd">            returned)</span>
<span class="sd">        log_file : str</span>
<span class="sd">            string containing the directory to a log file to be written out</span>
<span class="sd">            when using this function</span>
<span class="sd">        plot : bool</span>
<span class="sd">            if true, a plot is made, comparing the original dataset with the</span>
<span class="sd">            new, filtered dataset</span>
<span class="sd">        final : bool</span>
<span class="sd">            if true, the values are actually replaced with nan values (either</span>
<span class="sd">            inplace or in a new hp object)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        HydroData object (if inplace=False)</span>
<span class="sd">            the dataframe from which the double values of &#39;data&#39; are removed</span>
<span class="sd">        None (if inplace=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span> <span class="o">=</span> <span class="s1">&#39;valid&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">len_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Slicing not possible for index type &quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot; and arange argument type &quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;. Try changing the type of the arange &quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;values to one compatible with &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> \
            <span class="s2">&quot; slicing.&quot;</span><span class="p">)</span>

        <span class="c1">#if plot == True:</span>
        <span class="c1">#    original = self.__class__(self.data.copy(),timedata_column=self.timename,</span>
        <span class="c1">#                              experiment_tag=self.tag,time_unit=self.time_unit)</span>
        <span class="c1"># Make temporary object for operations</span>
        <span class="n">df_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                                 <span class="n">timedata_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timename</span><span class="p">,</span><span class="n">experiment_tag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                 <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)</span>
        <span class="c1"># Make a hydropy object with the smoothened data</span>
        <span class="n">smooth_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_moving_average</span><span class="p">(</span><span class="n">arange</span><span class="p">,</span><span class="n">window</span><span class="p">,</span><span class="n">data_name</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                 <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Make a mask by comparing smooth and original data, using the given</span>
        <span class="c1"># cut-off percentage</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">smooth_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">])</span><span class="o">/</span>\
                <span class="n">smooth_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">cutoff_frac</span>

        <span class="c1"># Update the index of self.meta_valid</span>
        <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reset_meta_valid</span><span class="p">(</span><span class="n">data_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(),</span><span class="n">fill_value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Do the actual filtering, based on the mask</span>
        <span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">len_new</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">log_file</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_print_removed_output</span><span class="p">(</span><span class="n">len_orig</span><span class="p">,</span><span class="n">len_new</span><span class="p">,</span><span class="s1">&#39;moving average filter&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">_log_removed_output</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span><span class="n">len_orig</span><span class="p">,</span><span class="n">len_new</span><span class="p">,</span><span class="s1">&#39;filtered&#39;</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Please provide the location of the log file as </span><span class="se">\</span>
<span class="s1">                            a string type, or leave the argument if no log </span><span class="se">\</span>
<span class="s1">                            file is needed.&#39;</span><span class="p">)</span>
        <span class="c1"># Create new temporary object, where the dropped datapoints are replaced</span>
        <span class="c1"># by nan values (by assigning a new column to the original dataframe)</span>
        <span class="n">df_temp_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">timedata_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timename</span><span class="p">,</span>
                                   <span class="n">experiment_tag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span><span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)</span>
        <span class="n">df_temp_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span>
        <span class="n">df_temp_2</span><span class="o">.</span><span class="n">_update_time</span><span class="p">()</span>
        <span class="c1"># Update the self.meta_valid dataframe, to contain False values for dropped</span>
        <span class="c1"># datapoints. This is done by tracking the nan values in df_temp_2</span>
        <span class="k">if</span> <span class="n">data_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">temp_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;filtered&#39;</span><span class="p">])</span>
            <span class="n">temp_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">df_temp_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]),</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">temp_3</span> <span class="o">=</span> <span class="n">temp_1</span> <span class="o">|</span> <span class="n">temp_2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">temp_3</span><span class="p">,</span><span class="s1">&#39;filtered&#39;</span><span class="p">,</span><span class="s1">&#39;original&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">df_temp_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">],</span><span class="s1">&#39;filtered&#39;</span><span class="p">,</span><span class="s1">&#39;original&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_analysed</span><span class="p">(</span><span class="n">data_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">final</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_temp_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_time</span><span class="p">()</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">df_temp_2</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">final</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
</div>
<div class="viewcode-block" id="HydroData.savgol"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.savgol">[docs]</a>    <span class="k">def</span> <span class="nf">savgol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data_name</span><span class="p">,</span><span class="n">window</span><span class="o">=</span><span class="mi">55</span><span class="p">,</span><span class="n">polyorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses the scipy.signal Savitzky-Golay filter to smoothen the data of a column;</span>
<span class="sd">        The values are either replaced or a new dataframe is returned.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_name : str</span>
<span class="sd">            name of the column containing the data that needs to be filtered</span>
<span class="sd">        window : int</span>
<span class="sd">            the length of the filter window; default to 55</span>
<span class="sd">        polyorder : int</span>
<span class="sd">            The order of the polynomial used to fit the samples.</span>
<span class="sd">            polyorder must be less than window. default to 1</span>
<span class="sd">        plot : bool</span>
<span class="sd">            if true, a plot is made, comparing the original dataset with the</span>
<span class="sd">            new, filtered dataset</span>
<span class="sd">        inplace : bool</span>
<span class="sd">            indicates whether a new dataframe is created and returned or whether</span>
<span class="sd">            the operations are executed on the existing dataframe (nothing is</span>
<span class="sd">            returned)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        HydroData object (if inplace=False)</span>
<span class="sd">        None (if inplace=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">signal</span>

        <span class="n">df_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">timedata_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timename</span><span class="p">,</span>
                                   <span class="n">experiment_tag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span><span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)</span>

        <span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">savgol_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span>\
                                    <span class="p">,</span><span class="n">window</span><span class="p">,</span><span class="n">polyorder</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">],</span><span class="s1">&#39;g--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;original data&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">],</span><span class="s1">&#39;b-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;filtered data&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timename</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">data_name</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df_temp</span>
</div>
<span class="c1">#==============================================================================</span>
<span class="c1"># DATA (COR)RELATION</span>
<span class="c1">#==============================================================================</span>
<div class="viewcode-block" id="HydroData.calc_ratio"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.calc_ratio">[docs]</a>    <span class="k">def</span> <span class="nf">calc_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data_1</span><span class="p">,</span><span class="n">data_2</span><span class="p">,</span><span class="n">arange</span><span class="p">,</span><span class="n">only_checked</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given two datasets or -columns, calculates the average ratio between</span>
<span class="sd">        the first and second dataset, within the given range. Also the standard</span>
<span class="sd">        deviation on this is calculated</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_1 : str</span>
<span class="sd">            name of the data column containing the data to be in the numerator</span>
<span class="sd">            of the ratio calculation</span>
<span class="sd">        data_2 : str</span>
<span class="sd">            name of the data column containing the data to be in the denominator</span>
<span class="sd">            of the ratio calculation</span>
<span class="sd">        arange : array of two values</span>
<span class="sd">            the range within which the ratio needs to be calculated</span>
<span class="sd">        only_checked : bool</span>
<span class="sd">            if &#39;True&#39;, filtered values are excluded; default to &#39;False&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The average ratio of the first data column over the second one within</span>
<span class="sd">        the given range and including the standard deviation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If indexes are in datetime format, convert the arange array to date-</span>
        <span class="c1"># time values</span>
        <span class="c1">#if isinstance(self.data.index[0],pd.tslib.Timestamp):</span>
        <span class="c1">#    arange = [(self.data.index[0] + dt.timedelta(arange[0]-1)),</span>
        <span class="c1">#              (self.data.index[0] + dt.timedelta(arange[1]-1))]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Slicing not possible for index type &quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot; and arange argument type &quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;. Try changing the type of the arange &quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;values to one compatible with &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> \
            <span class="s2">&quot; slicing.&quot;</span><span class="p">)</span>

        <span class="n">mean</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_1</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_2</span><span class="p">])[</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>\

        <span class="k">if</span> <span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Index out of bounds. Check whether the values of &#39;</span> <span class="o">+</span> \
            <span class="s1">&#39;&quot;arange&quot; are within the index range of the data.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">only_checked</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1">#create new pd.Dataframes for original values in range,</span>
            <span class="c1">#merge only rows in which both values are original</span>
            <span class="n">data_1_checked</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">data_1</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;original&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">data_1</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;original&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">data_2_checked</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">data_2</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_2</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;original&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> \
                    <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_2</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_2</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;original&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">ratio_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data_1_checked</span><span class="p">,</span><span class="n">data_2_checked</span><span class="p">,</span><span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">)</span>
            <span class="n">ratio_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">data_1</span><span class="p">,</span><span class="n">data_2</span>

            <span class="n">mean</span> <span class="o">=</span> <span class="p">(</span><span class="n">ratio_data</span><span class="p">[</span><span class="n">data_1</span><span class="p">]</span><span class="o">/</span><span class="n">ratio_data</span><span class="p">[</span><span class="n">data_2</span><span class="p">])</span>\
                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">std</span> <span class="o">=</span> <span class="p">(</span><span class="n">ratio_data</span><span class="p">[</span><span class="n">data_1</span><span class="p">]</span><span class="o">/</span><span class="n">ratio_data</span><span class="p">[</span><span class="n">data_2</span><span class="p">])</span>\
                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">data_1</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">data_2</span><span class="p">])</span>\
                                                <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">std</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">data_1</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">data_2</span><span class="p">])</span>\
                                                <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

        <span class="c1">#print(&#39;mean : &#39;+str(mean)+ &#39;\n&#39; +&#39;standard deviation : &#39;+str(std))</span>
        <span class="k">return</span> <span class="n">mean</span><span class="p">,</span><span class="n">std</span>
</div>
<div class="viewcode-block" id="HydroData.compare_ratio"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.compare_ratio">[docs]</a>    <span class="k">def</span> <span class="nf">compare_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data_1</span><span class="p">,</span><span class="n">data_2</span><span class="p">,</span><span class="n">arange</span><span class="p">,</span><span class="n">only_checked</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compares the average ratios of two datasets in multiple different ranges</span>
<span class="sd">        and returns the most reliable one, based on the standard deviation on</span>
<span class="sd">        the ratio values</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_1 : str</span>
<span class="sd">            name of the data column containing the data to be in the numerator</span>
<span class="sd">            of the ratio calculation</span>
<span class="sd">        data_2 : str</span>
<span class="sd">            name of the data column containing the data to be in the denominator</span>
<span class="sd">            of the ratio calculation</span>
<span class="sd">        arange : int</span>
<span class="sd">            the range (in days) for which the ratios need to be calculated and</span>
<span class="sd">            compared</span>
<span class="sd">        only_checked : bool</span>
<span class="sd">            if &#39;True&#39;, filtered values are excluded; default to &#39;False&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The average ratio within the range that has been found to be the most</span>
<span class="sd">        reliable one</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Make the array with ranges within which to compute ratios, based on</span>
        <span class="c1"># arange, indicating what the interval should be.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pd</span><span class="o">.</span><span class="n">tslib</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">):</span>
            <span class="n">days</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">arange</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> \
                    <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">days</span><span class="o">/</span><span class="n">arange</span><span class="p">))]</span>
            <span class="n">starts</span> <span class="o">=</span> <span class="p">[[</span><span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">days</span><span class="p">]</span>
            <span class="n">ends</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">arange</span><span class="p">)]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">days</span><span class="p">]</span>
            <span class="c1">#end = (self.data.index[-1] - self.data.index[0]).days+1</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">float</span><span class="p">):</span>
            <span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># +1 because int rounds downwards</span>
            <span class="n">starts</span> <span class="o">=</span> <span class="p">[[</span><span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">end</span><span class="p">)]</span>
            <span class="n">ends</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">arange</span><span class="p">,</span><span class="n">end</span><span class="o">+</span><span class="n">arange</span><span class="p">)]</span>

        <span class="n">ranges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span><span class="n">ends</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rel_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ranges</span><span class="p">)):</span>
            <span class="n">average</span><span class="p">,</span><span class="n">stdev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_ratio</span><span class="p">(</span><span class="n">data_1</span><span class="p">,</span><span class="n">data_2</span><span class="p">,</span><span class="n">ranges</span><span class="p">[</span><span class="n">r</span><span class="p">],</span><span class="n">only_checked</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">relative_std</span> <span class="o">=</span> <span class="n">stdev</span><span class="o">/</span><span class="n">average</span>
                <span class="k">if</span> <span class="n">relative_std</span> <span class="o">&lt;</span> <span class="n">rel_std</span><span class="p">:</span>
                    <span class="n">std</span> <span class="o">=</span> <span class="n">stdev</span>
                    <span class="n">avg</span> <span class="o">=</span> <span class="n">average</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">r</span>
                    <span class="n">rel_std</span> <span class="o">=</span> <span class="n">std</span><span class="o">/</span><span class="n">avg</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">):</span>
                <span class="k">pass</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Best ratio (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">avg</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">std</span><span class="p">)</span> <span class="o">+</span> \
        <span class="s1">&#39;) was found in the range: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ranges</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">avg</span><span class="p">,</span><span class="n">std</span>
</div>
<div class="viewcode-block" id="HydroData.get_correlation"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.get_correlation">[docs]</a>    <span class="k">def</span> <span class="nf">get_correlation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data_1</span><span class="p">,</span><span class="n">data_2</span><span class="p">,</span><span class="n">arange</span><span class="p">,</span><span class="n">zero_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">only_checked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the linear regression coefficients that relate data_1 to</span>
<span class="sd">        data_2</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_1 and data_2 : str</span>
<span class="sd">            names of the data columns containing the data between which the</span>
<span class="sd">            correlation will be calculated.</span>
<span class="sd">        arange : array</span>
<span class="sd">            array containing the beginning and end value between which the</span>
<span class="sd">            correlation needs to be calculated</span>
<span class="sd">        zero_intercept : bool</span>
<span class="sd">            indicates whether or not to assume a zero-intercept</span>
<span class="sd">        only_checked: bool</span>
<span class="sd">            if &#39;True&#39;, filtered values are excluded from calculation and plotting;</span>
<span class="sd">            default to &#39;False&#39;</span>
<span class="sd">            if a value in one column is filtered, the corresponding value in the second</span>
<span class="sd">            column also gets excluded!</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        the linear regression coefficients of the correlation, as well as the</span>
<span class="sd">        r-squared -value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If indexes are in datetime format, and arange values are not,</span>
        <span class="c1"># convert the arange array to datetime values</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pd</span><span class="o">.</span><span class="n">tslib</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">)</span> <span class="ow">and</span> \
        <span class="nb">isinstance</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">float</span><span class="p">):</span>
            <span class="n">wn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Replacing arange values, assumed to be relative time&#39;</span> <span class="o">+</span> \
            <span class="s1">&#39; values, with absolute values of type dt.datetime&#39;</span><span class="p">)</span>
            <span class="n">arange</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
                      <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">))]</span>

        <span class="c1">#if arange[0] &lt; self.time[0] or arange[1] &gt; self.time[-1]:</span>
        <span class="c1">#    raise IndexError(&#39;Index out of bounds. Check whether the values of &#39;+ \</span>
        <span class="c1">#    &#39;&quot;arange&quot; are within the index range of the data.&#39;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">only_checked</span><span class="p">:</span>
            <span class="c1">#create new pd.Dataframes for original values in range,</span>
            <span class="c1">#merge only rows in which both values are original</span>
            <span class="n">data_1_checked</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_1</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;original&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_1</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;original&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">data_2_checked</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_2</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_2</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;original&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_2</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_2</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;original&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">corr_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data_1_checked</span><span class="p">,</span><span class="n">data_2_checked</span><span class="p">,</span><span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">corr_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]][[</span><span class="n">data_1</span><span class="p">,</span><span class="n">data_2</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="n">corr_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">data_1</span><span class="p">,</span><span class="n">data_2</span>
        <span class="n">corr_data</span> <span class="o">=</span> <span class="n">corr_data</span><span class="p">[[</span><span class="n">data_1</span><span class="p">,</span><span class="n">data_2</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">zero_intercept</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">corr_data</span><span class="p">[</span><span class="n">data_1</span><span class="p">],</span><span class="n">corr_data</span><span class="p">[</span><span class="n">data_2</span><span class="p">])</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="n">slope</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">data_2</span><span class="p">]</span>
            <span class="n">intercept</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">r_sq</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">rsquared</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">regres</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[[</span><span class="n">data_1</span><span class="p">,</span><span class="n">data_2</span><span class="p">]][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
            <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">regres</span><span class="p">)</span>
            <span class="n">r_sq</span> <span class="o">=</span> <span class="n">r_value</span><span class="o">**</span><span class="mi">2</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_1</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_1</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">intercept</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_2</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_1</span><span class="p">][</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="s1">&#39;bo&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Linear fit&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">data_1</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">data_2</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
            <span class="c1">#fig.text(1,0.9,&#39;Slope: &#39;+str(slope) + &#39;\nIntercept: &#39;+str(intercept)+&#39;\nR$^2$: &#39;+str(r_sq),color=&#39;black&#39;,verticalalignment=&#39;bottom&#39;, bbox={&#39;edgecolor&#39;:&#39;black&#39;,&#39;pad&#39;:10,&#39;fill&#39;:False}, horizontalalignment=&#39;left&#39;,fontsize=17)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;slope: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; intercept: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">intercept</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; R2: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">r_sq</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">slope</span><span class="p">,</span><span class="n">intercept</span><span class="p">,</span><span class="n">r_sq</span>
</div>
<span class="c1">#==============================================================================</span>
<span class="c1"># DAILY PROFILE CALCULATION</span>
<span class="c1">#==============================================================================</span>

<div class="viewcode-block" id="HydroData.calc_daily_profile"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.calc_daily_profile">[docs]</a>    <span class="k">def</span> <span class="nf">calc_daily_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">arange</span><span class="p">,</span><span class="n">quantile</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">plot_method</span><span class="o">=</span><span class="s1">&#39;quantile&#39;</span><span class="p">,</span><span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">only_checked</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates a typical daily profile based on data from the indicated</span>
<span class="sd">        consecutive days. Also saves this average day, along with standard</span>
<span class="sd">        deviation and lower and upper percentiles as given in the arguments.</span>
<span class="sd">        Plotting is possible.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        column_name : str</span>
<span class="sd">            name of the column containing the data to calculate an average day</span>
<span class="sd">            for</span>
<span class="sd">        arange : 2-element array of ints</span>
<span class="sd">            contains the beginning and end day of the period to use for average</span>
<span class="sd">            day calculation</span>
<span class="sd">        quantile : float between 0 and 1</span>
<span class="sd">            value to use for the calculation of the quantiles</span>
<span class="sd">        plot : bool</span>
<span class="sd">            plot or not</span>
<span class="sd">        plot_method : str</span>
<span class="sd">            method to use for plotting. Available: &quot;quantile&quot; or &quot;stdev&quot;</span>
<span class="sd">        clear : bool</span>
<span class="sd">            wether or not to clear the key in the self.daily_profile dictionary</span>
<span class="sd">            that is already present</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            creates a dictionary self.daily_profile containing information</span>
<span class="sd">            on the average day as calculated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># several checks to make sure the right types, columns... are used</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daily_profile</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">daily_profile</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daily_profile</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">daily_profile</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">daily_profile</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;self.daily_profile dictionary already contains a &#39;</span> <span class="o">+</span>\
            <span class="s1">&#39;key &#39;</span> <span class="o">+</span> <span class="n">column_name</span> <span class="o">+</span> <span class="s1">&#39;. Set argument &quot;clear&quot; to True to erase the &#39;</span> <span class="o">+</span> \
            <span class="s1">&#39;key and create a new one.&#39;</span><span class="p">)</span>

        <span class="c1"># Give warning when replacing data from rain events and at the same time</span>
        <span class="c1"># check if arange has the right type</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rain</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;WWTP&#39;</span><span class="p">)</span> <span class="ow">and</span> \
                   <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">highs</span><span class="p">[</span><span class="s1">&#39;highs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Slicing not possible for index type &quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot; and arange argument type &quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;. Try changing the type of the arange &quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;values to one compatible with &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> \
            <span class="s2">&quot; slicing.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;OnlineSensorBased instance has no attribute &quot;highs&quot;. &#39;</span><span class="o">+</span>\
            <span class="s1">&#39;run .get_highs to tag the peaks in the dataset.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rain</span> <span class="p">:</span>
            <span class="n">wn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Data points obtained during a rain event will be used for&#39;</span> <span class="o">+</span> \
            <span class="s1">&#39; the calculation of an average day. This might lead to a not-&#39;</span> <span class="o">+</span> \
            <span class="s1">&#39;representative average day and/or high standard deviations.&#39;</span><span class="p">)</span>

        <span class="n">daily_profile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The values of arange must be of type int or dt.datetime&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="n">range_days</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">range_days</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">arange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">arange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#if isinstance(arange[0],dt.datetime):</span>
        <span class="c1">#    range_days = pd.date_range(arange[0],arange[1])</span>


        <span class="c1">#if only_checked:</span>
        <span class="c1">#    for i in range_days:</span>
        <span class="c1">#        daily_profile = pd.merge(daily_profile,</span>
        <span class="c1">#                        pd.DataFrame(self.data[column_name][i:i+1]\</span>
        <span class="c1">#                        [self.meta_valid[column_name]==&#39;original&#39;].values),</span>
        <span class="c1">#                        left_index=True, right_index=True,how=&#39;outer&#39;)</span>
        <span class="c1">#    mean_day = pd.DataFrame(index=daily_profile.index)</span>
        <span class="c1">#    self.data.loc[indexes[0]:indexes[1]].index)#\</span>
        <span class="c1">#    [self.meta_valid[column_name]==&#39;original&#39;].index)</span>
        <span class="c1">#    if isinstance(self.data.index[0],dt.datetime):</span>
        <span class="c1">#        mean_day.index = mean_day.index.time</span>
        <span class="c1">#else:</span>


        <span class="k">if</span> <span class="n">only_checked</span> <span class="ow">and</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">range_days</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">tslib</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">):</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">month</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">mask_valid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">column_name</span><span class="p">][</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;original&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                <span class="n">daily_profile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">daily_profile</span><span class="p">,</span>
                                         <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">column_name</span><span class="p">][</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                                      <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">name</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_valid</span><span class="p">),</span>
                                         <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">only_checked</span><span class="p">:</span>
                <span class="n">wn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;No values of selected column were filtered yet. All values &#39;</span><span class="o">+</span> \
                <span class="s1">&#39;will be displayed.&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">range_days</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">tslib</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">):</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">month</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">daily_profile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">daily_profile</span><span class="p">,</span>
                                         <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">column_name</span><span class="p">][</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                                      <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">name</span><span class="p">]),</span>
                                         <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>

        <span class="n">daily_profile</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indexes</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">indexes</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">time</span>
        <span class="n">daily_profile</span> <span class="o">=</span> <span class="n">daily_profile</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>\
                                     <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

        <span class="n">mean_day</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">daily_profile</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">daily_profile</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
        <span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">daily_profile</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
        <span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;Qupper&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">daily_profile</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">quantile</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
        <span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;Qlower&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">daily_profile</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">quantile</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">daily_profile</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_day</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean_day</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">],</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plot_method</span> <span class="o">==</span> <span class="s1">&#39;quantile&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean_day</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;Qupper&#39;</span><span class="p">],</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean_day</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;Qlower&#39;</span><span class="p">],</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">mean_day</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">],</span><span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;Qupper&#39;</span><span class="p">],</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">mean_day</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">],</span><span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;Qlower&#39;</span><span class="p">],</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">plot_method</span> <span class="o">==</span> <span class="s1">&#39;stdev&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean_day</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">],</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean_day</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">],</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">mean_day</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">],</span>
                                <span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">],</span>
                                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">mean_day</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">],</span>
                                <span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">mean_day</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">],</span>
                                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">mean_day</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mean_day</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span>
</div>
    <span class="c1">##############</span>
    <span class="c1">### PLOTTING</span>
    <span class="c1">##############</span>
<div class="viewcode-block" id="HydroData.plot_analysed"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.HydroData.plot_analysed">[docs]</a>    <span class="k">def</span> <span class="nf">plot_analysed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data_name</span><span class="p">,</span><span class="n">time_range</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span><span class="n">only_checked</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plots the values and their types (original, filtered, filled) \</span>
<span class="sd">        of a given column in the given time range.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_name : str</span>
<span class="sd">            name of the column containing the data to plot</span>
<span class="sd">        time_range : array of two values</span>
<span class="sd">            the range within which the values are plotted; default is all</span>
<span class="sd">        only_checked : bool</span>
<span class="sd">            if &#39;True&#39;, filtered values are excluded; default to &#39;False&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Plot</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># time range settings</span>
        <span class="k">if</span> <span class="n">time_range</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">float</span><span class="p">):</span>
                <span class="n">time_range</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
                <span class="n">time_range</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="ow">or</span> <span class="ow">not</span> \
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The value type of the values in time_range must &#39;</span> <span class="o">+</span> \
                <span class="s1">&#39;be the same as the value type of index values&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">time_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">time_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Index out of bounds. Check whether the values of &#39;</span><span class="o">+</span>\
                <span class="s1">&#39;&quot;time_range&quot; are within the index range of the data.&#39;</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

        <span class="c1">#create new object with only the values within the given time range</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">time_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">timedata_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timename</span><span class="p">,</span>
                            <span class="n">experiment_tag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span><span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span> <span class="o">==</span> <span class="s1">&#39;filled&#39;</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">time_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">time_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">filled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filled</span><span class="p">[</span><span class="n">time_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">time_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;original&#39;</span><span class="p">],</span>
                <span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;original&#39;</span><span class="p">],</span>
                <span class="s1">&#39;.g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;original&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">only_checked</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filtered&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filtered&#39;</span><span class="p">],</span>
                            <span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filtered&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;.r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;filtered&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filled_interpol&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filled_interpol&#39;</span><span class="p">],</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filled_interpol&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;.b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;filled (interpolation)&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filled_ratio&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filled_ratio&#39;</span><span class="p">],</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filled_ratio&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;.m&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;filled (ratio-based)&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filled_correlation&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filled_correlation&#39;</span><span class="p">],</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filled_correlation&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;.k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;filled (correlation-based)&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filled_average_profile&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filled_average_profile&#39;</span><span class="p">],</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filled_average_profile&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;.y&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;filled (typical day)&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filled_infl_model&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filled_infl_model&#39;</span><span class="p">],</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filled_infl_model&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;.c&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;filled (influent model)&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filled_profile_day_before&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filled_profile_day_before&#39;</span><span class="p">],</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">meta_filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filled_profile_day_before&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;filled (previous day)&#39;</span><span class="p">)</span>
            <span class="c1">#if (df.meta_filled[data_name]==&#39;filled_savitzky_golay&#39;).any():</span>
            <span class="c1">#    ax.plot(df.time[df.meta_filled[data_name]==&#39;filled_savitzky_golay&#39;],</span>
            <span class="c1">#            df.filled[data_name][df.meta_filled[data_name]==&#39;filled_savitzky_golay&#39;],</span>
            <span class="c1">#            &#39;.m&#39;,label=&#39;filled (Savitzky-Golay filter)&#39;)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span> <span class="o">==</span> <span class="s1">&#39;valid&#39;</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">meta_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">time_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">time_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;original&#39;</span><span class="p">],</span>
                <span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;original&#39;</span><span class="p">],</span>
                <span class="s1">&#39;.g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;original&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">only_checked</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filtered&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">data_name</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">filled</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filtered&#39;</span><span class="p">],</span>
                                <span class="n">df</span><span class="o">.</span><span class="n">filled</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filtered&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;.r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;filtered&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filtered&#39;</span><span class="p">],</span>
                                <span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_name</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;filtered&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;.r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;filtered&#39;</span><span class="p">)</span>
            <span class="nb">print</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">meta_valid</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">data_name</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="s1">&#39;original&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span> \
                <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()))</span> <span class="o">+</span> \
                <span class="s1">&#39;</span><span class="si">% d</span><span class="s1">atapoints are left over from the original &#39;</span> <span class="o">+</span> \
                <span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">meta_valid</span><span class="p">[</span><span class="n">data_name</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">())))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timename</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">data_name</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
</div></div>
<span class="c1">#    def plot_analysed(self,data_name):</span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#</span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#        fig = plt.figure(figsize=(16,6))</span>
<span class="c1">#        ax = fig.add_subplot(111)</span>
<span class="c1">#</span>
<span class="c1">#        if not self._plot == &#39;filled&#39; or self._plot == &#39;valid&#39;:</span>
<span class="c1">#            ValueError(&#39;No filtering or filling of the current dataset has been done.\</span>
<span class="c1">#                        Run any filter or filling function to start the data analysis.&#39;)</span>
<span class="c1">#</span>
<span class="c1">#        if self._plot == &#39;filled&#39;:</span>
<span class="c1">#            ax.plot(self.time[self.meta_filled[data_name]==&#39;original&#39;],</span>
<span class="c1">#                self.data[data_name][self.meta_filled[data_name]==&#39;original&#39;],</span>
<span class="c1">#                &#39;.g&#39;,label=&#39;original&#39;)</span>
<span class="c1">#            if (self.meta_filled[data_name]==&#39;filtered&#39;).any():</span>
<span class="c1">#                ax.plot(self.time[self.meta_filled[data_name]==&#39;filtered&#39;],</span>
<span class="c1">#                        self.data[data_name][self.meta_filled[data_name]==&#39;filtered&#39;],</span>
<span class="c1">#                        &#39;.r&#39;,label=&#39;filtered&#39;)</span>
<span class="c1">#            if (self.meta_filled[data_name]==&#39;filled_interpol&#39;).any():</span>
<span class="c1">#                ax.plot(self.time[self.meta_filled[data_name]==&#39;filled_interpol&#39;],</span>
<span class="c1">#                        self.filled[data_name][self.meta_filled[data_name]==&#39;filled_interpol&#39;],</span>
<span class="c1">#                        &#39;.b&#39;,label=&#39;filled (interpolation)&#39;)</span>
<span class="c1">#            if (self.meta_filled[data_name]==&#39;filled_ratio&#39;).any():</span>
<span class="c1">#                ax.plot(self.time[self.meta_filled[data_name]==&#39;filled_ratio&#39;],</span>
<span class="c1">#                        self.filled[data_name][self.meta_filled[data_name]==&#39;filled_ratio&#39;],</span>
<span class="c1">#                        &#39;.m&#39;,label=&#39;filled (ratio-based)&#39;)</span>
<span class="c1">#            if (self.meta_filled[data_name]==&#39;filled_correlation&#39;).any():</span>
<span class="c1">#                ax.plot(self.time[self.meta_filled[data_name]==&#39;filled_correlation&#39;],</span>
<span class="c1">#                        self.filled[data_name][self.meta_filled[data_name]==&#39;filled_correlation&#39;],</span>
<span class="c1">#                        &#39;.k&#39;,label=&#39;filled (correlation-based)&#39;)</span>
<span class="c1">#            if (self.meta_filled[data_name]==&#39;filled_average_profile&#39;).any():</span>
<span class="c1">#                ax.plot(self.time[self.meta_filled[data_name]==&#39;filled_average_profile&#39;],</span>
<span class="c1">#                        self.filled[data_name][self.meta_filled[data_name]==&#39;filled_average_profile&#39;],</span>
<span class="c1">#                        &#39;.y&#39;,label=&#39;filled (typical day)&#39;)</span>
<span class="c1">#            if (self.meta_filled[data_name]==&#39;filled_infl_model&#39;).any():</span>
<span class="c1">#                ax.plot(self.time[self.meta_filled[data_name]==&#39;filled_infl_model&#39;],</span>
<span class="c1">#                        self.filled[data_name][self.meta_filled[data_name]==&#39;filled_infl_model&#39;],</span>
<span class="c1">#                        &#39;.c&#39;,label=&#39;filled (influent model)&#39;)</span>
<span class="c1">#</span>
<span class="c1">#        elif self._plot == &#39;valid&#39;:</span>
<span class="c1">#            ax.plot(self.time[self.meta_valid[data_name]==&#39;original&#39;],</span>
<span class="c1">#                self.data[data_name][self.meta_valid[data_name]==&#39;original&#39;],</span>
<span class="c1">#                &#39;.g&#39;,label=&#39;original&#39;)</span>
<span class="c1">#            if (self.meta_valid[data_name]==&#39;filtered&#39;).any():</span>
<span class="c1">#                if data_name in self.filled.columns:</span>
<span class="c1">#                    ax.plot(self.time[self.meta_valid[data_name]==&#39;filtered&#39;],</span>
<span class="c1">#                        self.filled[data_name][self.meta_valid[data_name]==&#39;filtered&#39;],</span>
<span class="c1">#                        &#39;.r&#39;,label=&#39;filtered&#39;)</span>
<span class="c1">#                else:</span>
<span class="c1">#                    ax.plot(self.time[self.meta_valid[data_name]==&#39;filtered&#39;],</span>
<span class="c1">#                        self.data[data_name][self.meta_valid[data_name]==&#39;filtered&#39;],</span>
<span class="c1">#                        &#39;.r&#39;,label=&#39;filtered&#39;)</span>
<span class="c1">#</span>
<span class="c1">#        ax.legend(fontsize=16)</span>
<span class="c1">#        ax.set_xlabel(self.timename,fontsize=14)</span>
<span class="c1">#        ax.set_ylabel(data_name,fontsize=14)</span>
<span class="c1">#        ax.tick_params(labelsize=14)</span>
<span class="c1">#</span>
<span class="c1">#        print str(float(self.meta_valid.groupby(data_name).size()[&#39;original&#39;]*100)/ \</span>
<span class="c1">#                float(self.meta_valid[data_name].count())) + \</span>
<span class="c1">#                &#39;% datapoints are left over from the original &#39; + \</span>
<span class="c1">#                str(float(self.meta_valid[data_name].count()))</span>
<span class="c1">#        return fig, ax</span>


<span class="c1">##############################</span>
<span class="c1">###   NON-CLASS FUNCTIONS  ###</span>
<span class="c1">##############################</span>

<div class="viewcode-block" id="total_seconds"><a class="viewcode-back" href="../../wwdata.html#wwdata.Class_HydroData.total_seconds">[docs]</a><span class="k">def</span> <span class="nf">total_seconds</span><span class="p">(</span><span class="n">timedelta_value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">timedelta_value</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</div>
<span class="k">def</span> <span class="nf">_print_removed_output</span><span class="p">(</span><span class="n">original</span><span class="p">,</span><span class="n">new</span><span class="p">,</span><span class="n">function</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    function printing the output of functions that tag datapoints.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    original : int</span>
<span class="sd">        original length of the dataset</span>
<span class="sd">    new : int</span>
<span class="sd">        length of the new dataset</span>
<span class="sd">    function : str</span>
<span class="sd">        info on the function used to filter the data</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">original</span><span class="o">-</span><span class="n">new</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; values detected and tagged as filtered by function &#39;</span> <span class="o">+</span> <span class="n">function</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_log_removed_output</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span><span class="n">original</span><span class="p">,</span><span class="n">new</span><span class="p">,</span><span class="n">type_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    function writing the output of functions that remove datapoints to a log file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    log_file : str</span>
<span class="sd">        string containing the directory to the log file to be written out</span>
<span class="sd">    original : int</span>
<span class="sd">        original length of the dataset</span>
<span class="sd">    new : int</span>
<span class="sd">        length of the new dataset</span>
<span class="sd">    type_ : str</span>
<span class="sd">        &#39;removed&#39; or &#39;dropped&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">log_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">log_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Original dataset: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">original</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; datapoints; new dataset: &#39;</span><span class="o">+</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">new</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; datapoints&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">original</span><span class="o">-</span><span class="n">new</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; datapoints &#39;</span><span class="p">,</span><span class="n">type_</span><span class="p">))</span>
    <span class="n">log_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Prepends a WEST-header to read-in text files, to make them WEST compatible</span>
<span class="k">def</span> <span class="nf">_prepend_WEST_header</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span><span class="n">sep</span><span class="p">,</span><span class="n">column_names</span><span class="p">,</span><span class="n">outputfilename</span><span class="p">,</span>
                         <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;no comments&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputfilename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="c1">#f.write(&quot;%%Version3.3\ %%BeginComment\ &quot;)</span>
        <span class="c1">#f.write(comment)</span>
        <span class="c1">#f.write(&quot;%%EndComment\ %%BeginHeader\ &quot;)</span>
        <span class="c1">#f.write(str())#write the names</span>
        <span class="c1">#f.write(str())#write the units</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">wwdata 0.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Chaim De Mulder.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>